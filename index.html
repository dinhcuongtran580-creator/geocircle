const levels = [
        { name: 'LEVEL 1: TÂM O QUA A', task: 'Vẽ đường tròn tâm O(0,0) đi qua điểm A(3,3).', type: 'draw' },
        { name: 'LEVEL 2: BÁN KÍNH CHUẨN', task: 'Vẽ đường tròn tâm bất kỳ có Bán kính đúng bằng 4.', type: 'draw' },
        { name: 'LEVEL 3: CÔNG CỤ COMPA', task: 'Dùng công cụ Compa: Sao chép đoạn thẳng DE cho trước làm bán kính để vẽ đường tròn tâm C(0,0).', type: 'draw' },
        { name: 'LEVEL 4: QUA 3 ĐIỂM', task: 'Vẽ đường tròn đi qua 3 điểm không thẳng hàng: A(0,4), B(4,0) và C(-4,0).', type: 'draw' },
        { name: 'LEVEL 5: ĐO DIỆN TÍCH', task: 'Vẽ hình tròn R=5. Dùng công cụ đo diện tích (Area) và nhập kết quả bạn thấy (78.54).', type: 'text' }
    ];

    function setupLevel(api) {
        api.setCoordSystem(-10, 10, -7, 7);
        if (currentLvl === 0) api.evalCommand("A=(3,3)");
        if (currentLvl === 2) {
            api.evalCommand("D=(-5,2)"); api.evalCommand("E=(-2,2)"); 
            api.evalCommand("Segment(D, E)"); api.evalCommand("C=(0,0)");
        }
        if (currentLvl === 3) {
            // Khởi tạo 3 điểm không thẳng hàng cho người chơi
            api.evalCommand("A=(0,4)");
            api.evalCommand("B=(4,0)");
            api.evalCommand("C=(-4,0)");
        }
    }

    function validate() {
        const val = document.getElementById('ansInput').value.trim().toLowerCase();
        const msg = document.getElementById('msg');
        let isCorrect = false;

        try {
            const circleNames = ggbApp.getAllObjectNames("conic");
            const c = circleNames[0];

            if (currentLvl === 3) { // Validation cho Level 4
                const r = ggbApp.getValue(`Radius(${c})`);
                const center = [ggbApp.getXcoord(c), ggbApp.getYcoord(c)];
                
                // Kiểm tra 3 điểm A, B, C có nằm trên đường tròn (c) không
                // Đường tròn qua (0,4), (4,0), (-4,0) có tâm (0,0) bán kính 4
                if (Math.abs(r - 4) < 0.1 && Math.abs(center[0]) < 0.1 && Math.abs(center[1]) < 0.1) {
                    isCorrect = true;
                }
            } 
            // ... (Các logic Level 1, 2, 3, 5 giữ nguyên như bản trước)
        } catch (e) {
            msg.innerText = "⚠️ Hãy sử dụng đúng công cụ để vẽ hình!";
        }
        // ... (Phần xử lý handleSuccess và báo lỗi)
    }
